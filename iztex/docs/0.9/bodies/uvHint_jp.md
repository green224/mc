
# 概要

テクスチャのポテンシャルを100％引き出すには、UV編集の工程がとても重要になります。
現時点であらゆる状況にリーチする完全なUV編集の指針というものは無く、どのような表現を行いたいかによって方針を決めることになります。

ここではトゥーン表現を行いたい場合、一般的なUV展開と比較してよりよい品質を達成できる可能性のある手法「境界接続タイプ」を提案します。

IZTEX自体も主にトゥーン表現での使用を想定しているため、本手法の使用を推奨しますが、手法の内容については、IZTEXに限らず一般的なUV作成方針として適応できるものです。参考になれば幸いです。

# 対象となる表現

UV編集の方針を決めるにあたって、まず作成しているモデルが

フォトリアルな表示を行うもの

* 全面にわたって細かい凹凸やディテールが存在する
* 写実的表現を重視して、物理的でないテクスチャ表現は行わない

なのか、

トゥーン表現を行うもの

* 滑らかなグラデーションを使用する
* 物理的正しさより印象を重視する

もしくは、トゥーン以外のノンフォトリアル表現を行うものなのかを決めます。

トゥーン表現を目標としている場合には、境界接続タイプが効果的です。


# 手順

テクスチャ解像度がUV形状に影響するため、まず使用する解像度を決定します。

UV島の間隔は 0px, 4px, 10px,... の刻みで決定します。
中間の値にしても無駄ピクセルとなってしまうので、必ずテクスチャ内のUV島間隔はこれらのどれか一つの値に統一されるようにします。

一例ですが、テクスチャ解像度とUV島の間隔は

* 縦横2048px以上 なら 10px
* 縦横512px なら 4px
* 縦横128px以下 なら 0px

くらいにすると良いでしょう。

UV頂点を、使用するテクスチャ解像度のテクセル中央に配置されるようにします。
例えば解像度が512の場合は、UV座標が 0.5 / 512, 1.5 / 512, ... の座標間隔で配置するようにします。

これはDCCツールのスナップ機能を使用すれば簡単です。
Blenderであれば「UV > Snap to Pixels > Center」にてスナップの設定が可能です。

境界を見せたくない全てのUV境界で、以下のルールを適応します

* 接続に対応する双方のエッジの占有テクセル数が同じになるようにする
* UV両軸に対して、垂直か水平なエッジのみで構成されるようにする

これを守れなかったエッジは原理的にUV境界が見えてしまいます。
ベストではありませんが、斜め45度のエッジでもそれなりに綺麗です。垂直水平が難しい場所は斜め45度にしておくとよいでしょう。

また例外として画像のように、コーナー部分の頂点以外は整列方向に対してPixelスナップしていなくても構いません。（ただし接続に対応するもう片方エッジ部分でも、同じ間隔で頂点が配置されている必要があります）

ちゃんとテクセル中央に配置されているかが分かりやすいように、テクセルの見えるテクスチャを作成しておくと便利です。

縦横512pxのグリッド確認用テクスチャの例。ご自由にお使いください（CC0）

以上です。

---

# 技術的背景と解説

## 最小歪みタイプの問題点

一般的に使われているこのようなUV展開を、ここでは「最小歪みタイプ」と呼ぶことにします。
最小歪みタイプにはメリット・デメリットが存在します。

メリット

* 全面にわたってテクセル方向に歪みが少ない
* 広く普及しているため、効率的にUnwrapするための手法が数多く存在する

デメリット

* UV境界が見えてしまう

テクセル方向の歪みが少ないと何が良いのかというと、まず2D画像加工ソフトでの加工が行いやすいというメリットがあります。これは3Dペイントが普及する以前からとても重要な条件でしたが、殆どのDCCツールに3Dペイントが搭載されている昨今でも重視するケースは多いです。また、全面にわたってテクセル単位の細かい模様がついている場合は、歪みを少なくすることで表示の品質が上がる場合があります。

UV境界が見えてしまうと何が悪いのかというと、切れ目が目立つと違和感になるというのは明らかですが、切れ目を目立たせなくするために境界回りを工夫する必要があり、これが表現に多くの制限を生んでしまいます。

切れ目を目立たせなくするためにはいくつか方法があります。

1. 布の縫い目や、素材の変わり目など、切れ目が見えても違和感がない部分に境界を持ってくる
1. 細かいランダムな模様を表示して、目立たなくする
1. 近しい色を表示する

(1)が出来れば問題ないですが、これが適応できる部分は多くありません。フォトリアルテイストの場合は、自然と(2)が達成されてあまり問題を感じないかもしれません。トゥーン表現の場合(2)が使用できる部分は少なく、多くの部分で(3)を行う事になります。

ところがこの(3)は、テクセルの並びが完全に等しい境界でない限り、境界平行方向の色変化が大きいと切れ目を隠す事ができなくなるという問題があります（後述）。このため(3)を使用する限り、UV境界方向にはグラデーションを付けることができません。

これはトゥーン表現では特に問題になります。

例えば人体であれば多くの場合わきの下から腕の胴体側側面にUV境界を設定します。そして多くの場合わきの下は少し暗くしたい。ここでわきの下から腕にかけて滑らかに陰影を付けようとすると、UV境界に平行にグラデーションをつけることになります。脇以外でも、足も首も胴体も腕も指もあらゆる筒状の部分、本来であればなめらかなグラデーションを付けたい箇所が、UV境界と平行です。

細かなディテールがないモチーフの場合、UV境界が見えてしまうと余計に悪目立ちしてしまいますので、UV境界は見えないようにしなければなりません。この結果トゥーンの人肌などは特に、全体的に色変化の少ないのっぺりとしたテクスチャになりがちです。

## 境界接続タイプの特徴

境界接続タイプはUV境界を見えなくすることを第一目標とした手法であり、以下のメリット・デメリットがあります。

メリット

* UV境界が一切見えない

デメリット

* テクセル方向が歪みやすい
* 一般的な展開手法ではないため、Unwrapに手間がかかる

歪み最小タイプと比べてテクセル方向が歪みやすいため、画像加工ソフトでの後処理は比較的し辛くなります。

一方、トゥーン表現においてはUV境界を気にしなくて済むという点は大きな優位性です。

* トゥーン表現
* 画像加工ソフトでの破壊的編集はそもそもできればやりたくない

といった場合は、歪み最小タイプのメリットを享受できず、境界接続タイプのメリットが最大化するため、本手法の使用が最適と考えます。

## UV境界部分でのグラデーション

UV境界部分でテクセルの並びが一致していない場合、境界部分では「境界が見えないように色変化を行う」事が不可能となります。

TODO : ここ書く

## 島間隔の最適値について

TODO : ここ書く


